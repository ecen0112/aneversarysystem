{% extends "base.html" %}
{% block title %}Gallery{% endblock %}

{% block content %}
<h2 class="mb-4 text-center">ðŸ’– Our Gallery</h2>

<div class="row g-4">
    {% for img in images %}
    <div class="col-md-4 col-sm-6">
        <div class="card shadow-sm border-0 rounded-3 h-100">
            <img src="{{ url_for('static', filename='gallery/' ~ img.filename) }}"
                 class="card-img-top img-thumbnail gallery-img"
                 alt="Gallery Image"
                 data-bs-toggle="modal"
                 data-bs-target="#imageModal"
                 data-img="{{ url_for('static', filename='gallery/' ~ img.filename) }}">

            {% if session.get('role') == 'admin' %}
            <div class="card-body text-center">
                <form method="post"
                      action="{{ url_for('delete_image', image_id=img.id) }}"
                      onsubmit="return confirm('Are you sure you want to delete this image?');">
                    <button type="submit" class="btn btn-danger btn-sm w-100">Delete</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{% if session.get('role') == 'admin' %}
<div class="mt-5">
    <h4>ðŸ“¤ Upload New Image</h4>
    <form method="post" enctype="multipart/form-data" class="d-flex gap-2">
        <input type="file" name="image" class="form-control" required>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>
</div>
{% endif %}

<!-- Modal for full image preview -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark">
      <div class="modal-body text-center">
        <img src="" id="modalImage" class="img-fluid rounded" alt="Preview">
      </div>
    </div>
  </div>
</div>

<!-- Script for modal preview -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    const galleryImgs = document.querySelectorAll(".gallery-img");
    const modalImg = document.getElementById("modalImage");

    galleryImgs.forEach(img => {
        img.addEventListener("click", function() {
            modalImg.src = this.dataset.img;
        });
    });
});
</script>

{% endblock %}
